<?xml version="1.0" encoding="UTF-8"?><robot xmlns:xacro="http://www.ros.org/wiki/xacro">


<xacro:include filename="$(find hyq_description)/urdfs/cart/car.transmission.xacro"/>


<xacro:macro name="ext_car" params="parent *origin">

<material name="blue">
   <color rgba="0 0 0.8 1"/>
</material>
<material name="black">
   <color rgba="0 0 0 1"/>
</material>
<material name="white">
  <color rgba="1 1 1 1"/>
</material>

<!-- ball joint-->

      <joint name="yaw_robot_joint" type="revolute">
            <insert_block name="origin"/>
            <parent link="${parent}"/>
            <child link="ext_fake_link1"/>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <axis xyz="0 0 1 "/>
            <limit effort="150" velocity="12.0" lower="${-70*PI/180}" upper="${70*PI/180}"/>
      </joint>
      
             <link name="ext_fake_link1">
            <inertial>
            <mass value="1"/>
            <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4"/>
          </inertial>
        </link>  
         
      <joint name="pitch_robot_joint" type="revolute">
            <parent link="ext_fake_link1"/>
            <child link="ext_fake_link2"/>
            <axis xyz="0 0 1 "/>
            <origin xyz="0 0 0" rpy="-1.57 0 0"/>
             <limit effort="150" velocity="12.0" lower="${-70*PI/180}" upper="${70*PI/180}" />
      </joint>                 
      
      
        <link name="ext_fake_link2">
            <inertial>
            <mass value="1"/>
            <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4"/>
          </inertial>
        </link>  


   		<joint name="roll_robot_joint" type="revolute">
            <parent link="ext_fake_link2"/>
            <child link="ext_link1"/>
            <axis xyz="0 0 1 "/>
            <origin xyz="0 0 0" rpy=" 0 -1.57 0"/>
             <limit effort="150" velocity="12.0" lower="${-70*PI/180}" upper="${70*PI/180}" />
      </joint>     

       <link name="ext_link1">
            <inertial>
            <mass value="1"/>
            <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4"/>
          </inertial>
          <visual>
          <geometry>
           <cylinder length="1.0" radius="0.02"/>
         </geometry>
         <material name="blue"/>
         <origin rpy="0 0 0" xyz="0 0 0.5 "/>
       </visual>
        </link>
        <!--NB convention of subsequent rotations is YPR , the translation should be applied before in the previous parent frame-->
             
      
               
      <joint name="pitch_cart_joint" type="revolute">
            <parent link="ext_link1"/>
            <child link="ext_fake_link3"/>
            <axis xyz="0 0 1 "/>
            <origin xyz="0 0 1.0" rpy="0 1.57 0"/>
             <limit effort="150" velocity="12.0" lower="${-70*PI/180}" upper="${70*PI/180}"/>
      </joint>   

            <link name="ext_fake_link3">
            <inertial>
            <mass value="1"/>
            <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4"/>
          </inertial>
        </link>  
  
  
  
  
  
  
  
        <joint name="yaw_cart_joint" type="revolute">
            <parent link="ext_fake_link3"/>
            <child link="ext_fake_link4"/>
            <axis xyz="0 0 1 "/>
            <origin xyz="0 0 0.0" rpy="1.57 0  0"/>
             <limit effort="150" velocity="12.0" lower="${-70*PI/180}" upper="${70*PI/180}"/>
       </joint>   
  
          <link name="ext_fake_link4">
            <inertial>
            <mass value="1"/>
            <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4"/>
          </inertial>
        </link>  

  
  
  
  
  
  
  
  
  
  
  
  

      
        <!-- the fixed frames are merged with the cart--> 
        
       
                 <joint name="cart_attach" type="fixed">
            <parent link="ext_fake_link4"/>
            <child link="ext_cart"/>
            <origin rpy="0.0 0 0 " xyz="0 0 0.0 "/>        
      </joint>          
         

     
       <link name="ext_cart">
      
            <inertial>
           <origin xyz="-0.5 0 0.0"/>
            <mass value="400"/>
            <inertia ixx="1" ixy="0" ixz="0" iyy="1" iyz="0" izz="1"/>
          </inertial>       
       <visual>
         <origin xyz="-0.5 0 0.0"/>
          <geometry>
              <box size="1.0 1.0 0.5"/>
         </geometry>
         <material name="black"/>
    
       </visual>
     
     </link>
     
        <gazebo reference="ext_cart">
            <material>Gazebo/Black</material>
        </gazebo>  
     
     
     





     <joint name="right_wheel_joint" type="continuous">
        <parent link="ext_cart"/>
        <child link="ext_right_wheel"/>
        <origin rpy="1.57 0 0" xyz=" 0 -0.5 -0.25"/>

        <axis xyz="0 0 1"/>
        <dynamics damping="0.1" friction="0.0"/>
      </joint>
     
     <link name="ext_right_wheel">
                <inertial>
            <mass value="2"/>
            <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
          </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0.1"/>
      <geometry>
        <cylinder length="0.1" radius="0.3"/>
      </geometry>
      <material name="blue"/>
    </visual>
    
   <collision>
      <origin rpy="0 0 0" xyz="0 0 0.1"/>
      <geometry>
        <cylinder length="0.1" radius="0.3"/>
      </geometry>
    </collision>
  </link>
  
          <gazebo reference="ext_right_wheel">
            <material>Gazebo/Blue</material>
            <!-- kp and kd for rubber -->        
            <kp>1000000.0</kp>        
            <kd>100.0</kd>        
            <mu1>1.0</mu1>        
           <mu2>1.0</mu2>        
             <fdir1>1 0 0</fdir1>
            <maxVel>1.0</maxVel>
            <minDepth>0.00</minDepth>
        </gazebo>  
  
  <joint name="left_wheel_joint" type="continuous">
    <parent link="ext_cart"/>
    <child link="ext_left_wheel"/>
    <origin rpy="-1.57 0 0" xyz=" 0 0.5 -0.25"/>
    <axis xyz="0 0 1"/>
    <dynamics damping="0.1" friction="0.0"/>
  </joint>
     

  <link name="ext_left_wheel">
             <inertial>
            <mass value="2"/>
            <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
          </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0.1"/>
      <geometry>
        <cylinder length="0.1" radius="0.3"/>
      </geometry>
      <material name="blue"/>
    </visual>
     <collision>
      <origin rpy="0 0 0" xyz="0 0 0.1"/>
      <geometry>
        <cylinder length="0.1" radius="0.3"/>
      </geometry>
    </collision>
  </link>
        
        <gazebo reference="ext_left_wheel">
            <material>Gazebo/Blue</material>
            <!-- kp and kd for rubber -->        
            <kp>1000000.0</kp>        
            <kd>100.0</kd>        
            <mu1>1.0</mu1>        
           <mu2>1.0</mu2>        
             <fdir1>1 0 0</fdir1>
            <maxVel>1.0</maxVel>
            <minDepth>0.00</minDepth>
       </gazebo>     



<joint name="left_bwheel_joint" type="continuous">
    <parent link="ext_cart"/>
    <child link="ext_left_bwheel"/>
    <origin rpy="-1.57 0 0" xyz=" -1 0.5 -0.25"/>
    <axis xyz="0 0 1"/>
    <dynamics damping="0.1" friction="0.0"/>


  </joint>
     

  <link name="ext_left_bwheel">
             <inertial>
            <mass value="2"/>
            <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
          </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0.1"/>
      <geometry>
        <cylinder length="0.1" radius="0.3"/>
      </geometry>
      <material name="blue"/>
    </visual>
     <collision>
      <origin rpy="0 0 0" xyz="0 0 0.1"/>
      <geometry>
        <cylinder length="0.1" radius="0.3"/>
      </geometry>
    </collision>
  </link>
        
        <gazebo reference="ext_left_bwheel">
            <material>Gazebo/Red</material>
            <!-- kp and kd for rubber -->        
            <kp>1000000.0</kp>        
            <kd>100.0</kd>        
            <mu1>1.0</mu1>        
           <mu2>1.0</mu2>        
             <fdir1>1 0 0</fdir1>
            <maxVel>1.0</maxVel>
            <minDepth>0.00</minDepth>
       </gazebo>     



<joint name="right_bwheel_joint" type="continuous">
    <parent link="ext_cart"/>
    <child link="ext_right_bwheel"/>
    <origin rpy="-1.57 0 0" xyz=" -1 -0.5 -0.25"/>
    <axis xyz="0 0 1"/>
    <dynamics damping="1" friction="0.0"/>

</joint>
     

  <link name="ext_right_bwheel">
             <inertial>
            <mass value="2"/>
            <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
          </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 -0.1"/>
      <geometry>
        <cylinder length="0.1" radius="0.3"/>
      </geometry>
      <material name="blue"/>
    </visual>
     <collision>
      <origin rpy="0 0 0" xyz="0 0 -0.1"/>
      <geometry>
        <cylinder length="0.1" radius="0.3"/>
      </geometry>
    </collision>
  </link>
        
        <gazebo reference="ext_right_bwheel">
            <material>Gazebo/Red</material>
            <!-- kp and kd for rubber -->        
            <kp>1000000.0</kp>        
            <kd>100.0</kd>        
            <mu1>1.0</mu1>        
           <mu2>1.0</mu2>        
             <fdir1>1 0 0</fdir1>
            <maxVel>1.0</maxVel>
            <minDepth>0.00</minDepth>
       </gazebo>     

<xacro:car_transmission name="ext_car"/>

</xacro:macro>

</robot>
